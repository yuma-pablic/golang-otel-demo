receivers:
  otlp:
    protocols:
      grpc:
       endpoint: "0.0.0.0:4317"
      http:
       endpoint: "0.0.0.0:4318"
  filelog:
    include_file_path: true
    include: [/logs/app.log]
    operators:
      - type: json_parser
        parse_from: body
        timestamp:
          parse_from: body.time
          layout: '%Y-%m-%dT%H:%M:%S.%f%z'

processors:
  batch:
  transform:
    error_mode: ignore
    log_statements:
    - context: log
      statements:
        - set(attributes["my.service"], attributes["attrs"]["tag"])
  attributes/container_name:
    actions:
      - key: attrs
        action: delete
  resource/service_name:
    attributes:
      - key: service.name
        action: insert
        from_attribute: my.service

exporters:
  otlp:
    endpoint: tempo:9096
    tls:
      insecure: true
  otlphttp/logs:
    endpoint: "http://loki:3100/otlp"
    tls:
      insecure: true

extensions:
  health_check:
  pprof:
  zpages:

service:
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlp]
    logs:
      receivers: [filelog]
      processors: [transform, attributes/container_name, resource/service_name, batch]
      exporters: [otlphttp/logs]